---
ID: 4170
post_title: '[Nuxt.js] nuxt generateのパフォーマンスを改善させる方法'
published: true
post_date: 2019-02-21 01:21:17
modified_date: 2019-04-22 01:07:35
slug: 20190221012117.html
categories: |
  ---
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:536;s:4:\"name\";s:7:\"Nuxt.js\";s:4:\"slug\";s:7:\"nuxt.js\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:544;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:151:\"Vue.js
  \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u306E\u30D5\u30EC\u30FC\u30E0\u30EF\u30FC\u30AF\u3067\u3042\u308B
  Nuxt.js \u306B\u3064\u3044\u3066\u3001\u30C8\u30E9\u30D6\u30EB\u30B7\u30E5\u30FC\u30C6\u30A3\u30F3\u30B0\u306A\u3069\u3092\u8A18\u8F09\u3057\u3066\u3044\u307E\u3059\";s:6:\"parent\";i:0;s:5:\"count\";i:5;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:536;s:14:\"category_count\";i:5;s:20:\"category_description\";s:151:\"Vue.js
  \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u306E\u30D5\u30EC\u30FC\u30E0\u30EF\u30FC\u30AF\u3067\u3042\u308B
  Nuxt.js \u306B\u3064\u3044\u3066\u3001\u30C8\u30E9\u30D6\u30EB\u30B7\u30E5\u30FC\u30C6\u30A3\u30F3\u30B0\u306A\u3069\u3092\u8A18\u8F09\u3057\u3066\u3044\u307E\u3059\";s:8:\"cat_name\";s:7:\"Nuxt.js\";s:17:\"category_nicename\";s:7:\"nuxt.js\";s:15:\"category_parent\";i:0;}"
  ...
tags: |
  ---
  - !php/object "O:7:\"WP_Term\":10:{s:7:\"term_id\";i:523;s:4:\"name\";s:7:\"Nuxt.js\";s:4:\"slug\";s:7:\"nuxt-js\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:531;s:8:\"taxonomy\";s:8:\"post_tag\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:4;s:6:\"filter\";s:3:\"raw\";}"
  - !php/object "O:7:\"WP_Term\":10:{s:7:\"term_id\";i:519;s:4:\"name\";s:6:\"Vue.js\";s:4:\"slug\";s:6:\"vue-js\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:527;s:8:\"taxonomy\";s:8:\"post_tag\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:9;s:6:\"filter\";s:3:\"raw\";}"
  ...
---
## 背景

Netlifyでのデプロイ時に`nuxt generate`でのビルド時間が10分かかっていた。（route数は475）

`nuxt generate`のパフォーマンスを改善させたい。


## nuxt-generate-cluster

[nuxt-generate-cluster](https://github.com/nuxt-community/nuxt-generate-cluster)を使うことでビルドの並列処理を行うことができる。


### セットアップ

```
yarn add nuxt-generate-cluster
```

インストールしたら、`package.json`に下記のnpm scriptを追加・修正する。（Nuxt.jsのプロジェクトだと`nuxt generate`になっている部分を下記に書き換える）

```
&quot;generate&quot;: &quot;nuxt-generate -w 4 -b&quot;,
```

### 実行

`yarn generate`を実行すると、以下のようにworkerの立ち上がりが分かる。

```
6:22:17 PM: ℹ worker 1 started with pid 1379 
6:22:17 PM: ℹ worker 2 started with pid 1385 
6:22:17 PM: ℹ worker 3 started with pid 1391 
6:22:17 PM: ℹ worker 4 started with pid 1397 
6:22:25 PM: ✔ generated: /category.html      
6:22:26 PM: ✔ generated: /tag.html           
6:22:27 PM: ✔ generated: /index.html         
︙
︙
```

特に`nuxt.config.js`の設定を変更せずとも`nuxt-generate-cluster`を導入することができた。


## 結果

10分掛かっていたビルド時間が**4分まで短縮**することができた。

## 追記

ビルドオプションの[parallel](https://ja.nuxtjs.org/api/configuration-build/#parallel)を有効化してみた。

```
  build: {
    parallel: true,
  }
```

この設定によるものか定かではないが、さらに **174秒（3分）** まで短縮できた。