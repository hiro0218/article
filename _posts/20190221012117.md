---
ID: 4170
title: '[Nuxt.js] nuxt generateのパフォーマンスを改善させる方法'
published: true
date: 2019-02-21 01:21:17
updated: 2019-04-22 01:07:35
slug: 20190221012117.html
categories:
  - Nuxt.js
tags:
  - Nuxt.js
  - Vue.js
---
## 背景

Netlifyでのデプロイ時に`nuxt generate`でのビルド時間が10分かかっていた。（route数は475）

`nuxt generate`のパフォーマンスを改善させたい。


## nuxt-generate-cluster

[nuxt-generate-cluster](https://github.com/nuxt-community/nuxt-generate-cluster)を使うことでビルドの並列処理を行うことができる。


### セットアップ

```
yarn add nuxt-generate-cluster
```

インストールしたら、`package.json`に下記のnpm scriptを追加・修正する。（Nuxt.jsのプロジェクトだと`nuxt generate`になっている部分を下記に書き換える）

```
"generate": "nuxt-generate -w 4 -b",
```

### 実行

`yarn generate`を実行すると、以下のようにworkerの立ち上がりが分かる。

```
6:22:17 PM: ℹ worker 1 started with pid 1379 
6:22:17 PM: ℹ worker 2 started with pid 1385 
6:22:17 PM: ℹ worker 3 started with pid 1391 
6:22:17 PM: ℹ worker 4 started with pid 1397 
6:22:25 PM: ✔ generated: /category.html      
6:22:26 PM: ✔ generated: /tag.html           
6:22:27 PM: ✔ generated: /index.html         
︙
︙
```

特に`nuxt.config.js`の設定を変更せずとも`nuxt-generate-cluster`を導入することができた。


## 結果

10分掛かっていたビルド時間が**4分まで短縮**することができた。

## 追記

ビルドオプションの[parallel](https://ja.nuxtjs.org/api/configuration-build/#parallel)を有効化してみた。

```
  build: {
    parallel: true,
  }
```

この設定によるものか定かではないが、さらに **174秒（3分）** まで短縮できた。