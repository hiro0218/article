---
ID: 1430
post_title: '[FuelPHP] ルーティングで正規表現を使ってindexを消す方法'
published: true
post_date: 2014-10-14 15:28:58
modified_date: 2014-10-20 11:21:13
slug: 20141014152858.html
---
<p>かなりニッチな事案かもしれないけれど。<br />
<!--more--></p>
<h2>前提</h2>
<h3>構成</h3>
<p>ユーザー画面と管理画面があって、それぞれを別々にしている構成のアプリがあった。<br />
コントローラはこんな感じ。</p>
<pre>controller
├─admin
│  └─user
└─users
    └─settings
</pre>
<p><code>admin/user</code>という機能には、ユーザーの一覧表示や新規作成、編集機能などがある。他のコントローラとの兼ね合いを考えた時にこの「ユーザー管理」のコントローラは<code>index.php</code>として各アクションに<code>action_list</code>, <code>action_new</code>, <code>action_edit</code>を追加していった。(<code>user/～</code>も同様)</p>
<h3>URIの形式</h3>
<p>この構成にしたときに困るのがURIでルーティングを設定しないでコイツを呼び出そうとすると、こんな感じになる。</p>
<pre>http://localhost/APP/admin/user/index/list</pre>
<p>間にコントローラ名のindexが入る形で格好悪い。</p>
<h3>ルーティングをする</h3>
<p><code>fuel/app/config/routes.php</code>でルーティングの設定ができる。<br />
<strong>前述のコントローラの構成</strong>でかつ<strong>間にindexを入れないようにする</strong>と</p>
<pre><code>'admin/user/list' =&gt; 'admin/user/index/list',
'admin/user/new'  =&gt; 'admin/user/index/csv',
'admin/user/edit' =&gt; 'admin/user/index/new',
</code></pre>
<p>単純に考えると、こんな感じで設定してやる必要がでてくる。<br />
一応はこれで解決はする。</p>
<h2>ルーティングの設定に正規表現を使う</h2>
<p><code>action</code>の数だけルーティングの行数が増えていくのはつらい。</p>
<p>解決方法は<a href="http://fuelphp.jp/docs/1.7/general/routing.html">公式ドキュメント(ルーティング)</a>に書いてあった。こいつは正規表現が使えるみたい。<br />
今回のケースだと複雑な正規表現は書かなくて済みそうなので確認してみる。</p>
<p>やや高度なルーティングとあるが、これを使う。難しくはない。</p>
<blockquote><p>
  <b>:any</b> &#8211; URI の任意の部分にマッチする</p>
<pre>'blog/(:any)' =&gt; 'blog/entry/$1', // /blog/entry_name が /blog/entry/entry_name に経路付けられる</pre>
</blockquote>
<p>サンプルを見ると<code>:any</code>の部分が<code>$1</code>に相当するみたい。</p>
<p>これを踏まえた上で、今回の構成を吸収するように記述すると以下。</p>
<pre>'admin/user/(:any)' =&gt; 'admin/user/index/$1',</pre>
<p>これで<code>action</code>の数だけ書かないといけなかったルーティングの設定が1行で済むようになった。</p>
<hr>
<p>まだ使うような余地はないけれど、正規表現を使ってもっと汎用的なルーティング設定もできそう。</p>