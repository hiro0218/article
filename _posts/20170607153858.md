---
ID: 3084
post_title: '[Firefox] imgの縦横サイズが保たれない場合の対処法'
published: true
post_date: 2017-06-07 15:38:58
modified_date: 2017-06-07 15:38:58
slug: 20170607153858.html
categories: |
  ---
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:385;s:4:\"name\";s:3:\"CSS\";s:4:\"slug\";s:3:\"css\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:403;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:22;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:385;s:14:\"category_count\";i:22;s:20:\"category_description\";s:0:\"\";s:8:\"cat_name\";s:3:\"CSS\";s:17:\"category_nicename\";s:3:\"css\";s:15:\"category_parent\";i:0;}"
  ...
tags: |
  ---
  - !php/object "O:7:\"WP_Term\":10:{s:7:\"term_id\";i:83;s:4:\"name\";s:7:\"Firefox\";s:4:\"slug\";s:7:\"firefox\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:86;s:8:\"taxonomy\";s:8:\"post_tag\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:16;s:6:\"filter\";s:3:\"raw\";}"
  ...
---
## 状況
画像の遅延読み込みの為、`src`に直接URLを指定せずにdata属性に指定して、JavaScriptで置き換える処理を行っていた。

```language-html
&lt;img data-src=&quot;https://example.jp/super.png&quot;&gt;
```

このimg要素には`height / width`が指定されているが、Firefoxにおいては縦横サイズが保たれずに、JSによるsrc置き換え後の画像ロード後に縦横サイズが決まるような動きであった。
Chrome や Safari では問題なし。

## 対処法
### そもそもの原因
Firefoxだと、img要素にsrcが無い場合に「壊れた画像」として扱われ、縦横サイズを指定してもサイズが保たれないようである。（`alt`の内容だけを表示される）

### コード
`src`にダミー画像をセットしておけば解決するが、下記のようなCSSを指定する事でも解決する。
```language-css
img {
  -moz-force-broken-image-icon: 1;
}
```

## 参考
[-moz-force-broken-image-icon - CSS | MDN](https://developer.mozilla.org/ja/docs/Web/CSS/-moz-force-broken-image-icon)