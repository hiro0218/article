---
ID: 4261
post_title: '[Nuxt.js] アンカーリンクの遷移が動作しない場合の対処方法'
published: true
post_date: 2019-05-27 09:30:11
modified_date: 2019-05-27 09:30:18
slug: 20190527093011.html
categories: |
  ---
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:536;s:4:\"name\";s:7:\"Nuxt.js\";s:4:\"slug\";s:7:\"nuxt.js\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:544;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:151:\"Vue.js
  \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u306E\u30D5\u30EC\u30FC\u30E0\u30EF\u30FC\u30AF\u3067\u3042\u308B
  Nuxt.js \u306B\u3064\u3044\u3066\u3001\u30C8\u30E9\u30D6\u30EB\u30B7\u30E5\u30FC\u30C6\u30A3\u30F3\u30B0\u306A\u3069\u3092\u8A18\u8F09\u3057\u3066\u3044\u307E\u3059\";s:6:\"parent\";i:0;s:5:\"count\";i:5;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:536;s:14:\"category_count\";i:5;s:20:\"category_description\";s:151:\"Vue.js
  \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u306E\u30D5\u30EC\u30FC\u30E0\u30EF\u30FC\u30AF\u3067\u3042\u308B
  Nuxt.js \u306B\u3064\u3044\u3066\u3001\u30C8\u30E9\u30D6\u30EB\u30B7\u30E5\u30FC\u30C6\u30A3\u30F3\u30B0\u306A\u3069\u3092\u8A18\u8F09\u3057\u3066\u3044\u307E\u3059\";s:8:\"cat_name\";s:7:\"Nuxt.js\";s:17:\"category_nicename\";s:7:\"nuxt.js\";s:15:\"category_parent\";i:0;}"
  ...
tags: |
  ---
  - JavaScript
  - Vue.js
  ...
---
## 状況
- ページ内アンカーリンクがある
	- `#foo`, `#bar` …
- アンカーリンクをクリックするとページ内遷移ではなく、ルートページに移動してしまう

## 原因
`nuxt.config.js`に設定されている`router.base`が原因だった（未設定でも下記のようなデフォルト値が入る）

```js
// nuxt.config.js
export default {
  router: {
    base: &#039;/&#039;
  }
}
```

これにより、`<base href="/">`が`<head>`内に追加されパスが変わってしまっているようであった。

### vue-meta

Nuxt.jsにおいては、vue-routerとの兼ね合いもあり、`head()`（vue-meta）経由の`<base>`の書き換えはできない模様。

（書き換えられたとして、そちら側で問題が起きそう）

## 対応方法
そのままでは、先述のように`<base href="/">`に引っ張られてしまうため、アンカー要素に対して処理を施した。

対象のリンクに対して下記のようなイベントを付与。
```js
element.addEventListener(&#039;click&#039;, e =&gt; {
  e.preventDefault();
  e.stopPropagation();

  setTimeout(() =&gt; {
    const target = document.querySelector(element.hash);
    if (target) {
      window.scrollTo({ left: 0, top: target.offsetTop, behavior: &#039;smooth&#039; });
    }
  }, 0);
});
```

アンカー要素のイベントを止めて、アンカー対象の要素の位置までスクロールさせるといった処理である。
Nuxt.js側の処理とかち合うケースがあったため、`setTimeout`でタイミングをずらしている。