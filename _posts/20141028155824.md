---
ID: 1492
post_title: '[FuelPHP] DBクラスの結果を1次元連想配列に変換する方法'
published: true
post_date: 2014-10-28 15:58:24
modified_date: 2014-10-30 14:26:07
slug: 20141028155824.html
categories: |
  ---
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:300;s:4:\"name\";s:7:\"FuelPHP\";s:4:\"slug\";s:7:\"fuelphp\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:358;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:17;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:300;s:14:\"category_count\";i:17;s:20:\"category_description\";s:0:\"\";s:8:\"cat_name\";s:7:\"FuelPHP\";s:17:\"category_nicename\";s:7:\"fuelphp\";s:15:\"category_parent\";i:0;}"
  ...
tags: |
  --- []
  ...
---
多次元連想配列で返ってくるのはありがたいんだけれど、取得するカラムが2つだった時に1次元で返して欲しかったので色々したメモ。
<!--more-->

## 前提
FuelPHPのDBクラスで結果は連想配列で取得できる。(デフォルト)

### DBクラスを使う
DBクラスを使ってテーブルの値を取得する。

```language-php
$result = DB::select(&#039;user_id&#039;,&#039;user_name&#039;)-&gt;from(&#039;users&#039;)-&gt;execute();

$result_array = $result-&gt;as_array();

Debug::dump($result_array);
```

### 取得結果
取得した結果は以下のような感じの構成になっているはず。

```language-php
array(
   array(
       &#039;yamada&#039; =&gt; &#039;山田奈緒子&#039;
   ),
   array(
       &#039;ueda&#039;   =&gt; &#039;上田次郎&#039;
   ),
   array(
       &#039;yabe&#039;   =&gt; &#039;矢部謙三&#039;
   )
);
```

個人的にこんな感じで欲しかったのでFuelPHPのクラスを使って

```language-php
array(
  &#039;yamada&#039; =&gt; &#039;山田奈緒子&#039;,
  &#039;ueda&#039;   =&gt; &#039;上田次郎&#039;,
  &#039;yabe&#039;   =&gt; &#039;矢部謙三&#039;
);
```

## 取得
Arrクラスの`assoc_to_keyval`を使う

```language-php
$result = DB::select(&#039;user_id&#039;,&#039;user_name&#039;)-&gt;from(&#039;users&#039;)-&gt;execute();

$result_array = $result-&gt;as_array();

$result_array = Arr::assoc_to_keyval($result_array, &#039;user_id&#039;, &#039;user_name&#039;);
```

これで意図した配列になった。

---

`assoc_to_keyval`はkeyの添字とvalueの添字を指定しないといけない。ここではDBクラスから取得してきた連想配列なのでテーブルのカラム名(物理)になっているのでそれを指定してやる必要がある。
これの指定をミスると空ぶってしまうのでDBクエリでエイリアスを指定してやるとミスが減るかもしれない。

```language-php
DB::select(array(&#039;user_id&#039;,&#039;namae&#039;))-&gt;from(&#039;users&#039;)-&gt;execute();
```

## 追記

![screenshot_2019-01-05 a pen by hiro](https://user-images.githubusercontent.com/3617124/50723419-bc763580-1120-11e9-824f-0534ae63eccb.png)

### execute()->as_array(キー)を使う
はてブにて、`id:Kenji_s`さんから「execute()->as_array(キー) でok」というコメントを頂いたので`as_array(キー)`で確認してみました。

```language-php
$result = DB::select(&#039;user_id&#039;,&#039;user_name&#039;)-&gt;from(&#039;users&#039;)-&gt;execute()-&gt;as_array(&#039;user_id&#039;,&#039;user_name&#039;);
```

前述と同じく意図した配列がスマートに取得できた。今後はこの方法でやることにした。