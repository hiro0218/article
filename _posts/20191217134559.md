---
ID: 4373
post_title: >
  ejsファイルをPrettierでフォーマット実行する際の覚書
author: hiro
post_excerpt: ""
layout: post
permalink: https://b.0218.jp/20191217134634.html
published: true
post_date: 2019-12-17 13:46:34
---
## 前提

ejsは、HTMLと`<% %>`を混在させて使用する。だが、Prettierはejsのフォーマットに対応していないため、`html`フォーマットをかける必要がある。

```bash
prettier --parser html --write src/**/*.ejs
```

## ejsをhtmlフォーマットする問題

HTMLのみの記述であれば全く問題ない。ただ、`<% %>`記法が混在する時に問題が起きるケースがある。

下記のような1行の記述であれば問題ないのだが、

```ejs
&lt;%- include(&#039;components/_page-title); %&gt;
```

下記のような複数行に渡る記述の場合に問題が起こる。

```ejs
&lt;%- 
  include(&#039;components/_page-title&#039;, {
    title: &#039;Multi-size item to choose by height and weight&#039;,
    description: &#039;Popular brand items at your ideal size&#039;,
    link: {
      url: &#039;https://example.com/&#039;,
      title: &#039;View all&#039;,
    },
  });
%&gt;
```

上記を`--parse html`でフォーマットすると下記のようになってしまう。

```ejs
&lt;%- include(&#039;components/_page-title&#039;, { title: &#039;Multi-size item to choose by height and weight&#039;, description: &#039;Popular
brand items at your ideal size&#039;, link: { url: &#039;https://example.com/&#039;, title: &#039;View all&#039;, }, }); %&gt;
```

記述を分断されて改行などが入ってしまうため、ejsとしてビルドができなくなってしまう。


### 回避策

`<!-- prettier-ignore -->`を利用する。

ignoreコメントをejs記法の前に記述しても意味をなさない。そのため、下記のようにHTML要素をラップして記述する必要がある。


```ejs
&lt;!-- prettier-ignore --&gt;
&lt;div&gt;
&lt;%- 
  include(&#039;components/_page-title&#039;, {
    title: &#039;Multi-size item to choose by height and weight&#039;,
    description: &#039;Popular brand items at your ideal size&#039;,
    link: {
      url: &#039;https://example.com/&#039;,
      title: &#039;View all&#039;,
    },
  });
%&gt;
&lt;/div&gt;
```

こうすることでejsの記述をフォーマットさせることなく、`--parse html`を実行することができる。

#### 課題

```ejs
&lt;%
const foo = 1;
let bar = foo;

bar = 9;
%&gt;
```

こういったHTMLをラップする必要が皆無の場合、HTMLを記述する箇所がほぼ皆無だったため、`.prettierignore`に記述して回避した。