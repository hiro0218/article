---
ID: 1231
post_title: '[JavaScript] ファイルサイズを数値に直す関数'
published: true
post_date: 2014-04-24 14:27:20
modified_date: 2015-02-28 22:30:50
slug: 20140424142720.html
categories: |
  ---
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:384;s:4:\"name\";s:10:\"JavaScript\";s:4:\"slug\";s:10:\"javascript\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:402;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:53;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:384;s:14:\"category_count\";i:53;s:20:\"category_description\";s:0:\"\";s:8:\"cat_name\";s:10:\"JavaScript\";s:17:\"category_nicename\";s:10:\"javascript\";s:15:\"category_parent\";i:0;}"
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:14;s:4:\"name\";s:15:\"\u30D7\u30ED\u30B0\u30E9\u30E0\";s:4:\"slug\";s:7:\"program\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:14;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:121;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:14;s:14:\"category_count\";i:121;s:20:\"category_description\";s:0:\"\";s:8:\"cat_name\";s:15:\"\u30D7\u30ED\u30B0\u30E9\u30E0\";s:17:\"category_nicename\";s:7:\"program\";s:15:\"category_parent\";i:0;}"
  ...
tags: |
  --- false
  ...
---
ファイルサイズなどの数値を比較するとき、カンマとか単位とか付いていると非常に面倒です。
こんな感じ。
<pre>
6B
102KB
2,500KB
800MB
2GB
1TB
</pre>
上記のような文字列にある程度対応できるような関数を作ってみた。
<!--more-->
<h2>ファイルサイズ変換関数</h2>
<pre class="prettyprint linenums lang-js">function fileSizeFormat(size) {
  var s   = size.split(",").join("");
  var suf = ( (s.match(/(B|KB|MB|GB|TB)$/gi)||[])[0] || "B" ).toUpperCase();
  var num = parseFloat(s.match(new RegExp(/^[0-9]+(\.[0-9]+)?/))[0]);
  var mul = 1024;

  switch (suf) {
    case "B":
      return num;
    case "KB":
      return num * Math.pow(mul, 1);
    case "MB":
      return num * Math.pow(mul, 2);
    case "GB":
      return num * Math.pow(mul, 3);
    case "TB":
      return num * Math.pow(mul, 4);
  }
}
</pre>
変な単位が来たときはB(バイト)にしています。あと、単位がない場合もB(バイト)とされます。

「SI接頭辞」や「2進接頭辞」に応じて<b>1024</b>は<b>1000</b>などに変えてください。
また、ペタバイト(PB)・エクサバイト(EB)…など増やしていく場合は、それぞれ正規表現と<code>Switch</code>に追加していってください。

<h2>使い方</h2>
<pre class="prettyprint">var size = '2,048KB';
fileSizeFormat(size);
// => 2097152</pre>