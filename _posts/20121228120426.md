---
ID: 601
post_title: '[jQuery UI datepicker] 不正な日付を修正する方法'
published: true
post_date: 2012-12-28 12:04:26
modified_date: 2015-02-28 22:25:49
slug: 20121228120426.html
categories: |
  ---
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:383;s:4:\"name\";s:6:\"jQuery\";s:4:\"slug\";s:6:\"jquery\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:401;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:16;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:383;s:14:\"category_count\";i:16;s:20:\"category_description\";s:0:\"\";s:8:\"cat_name\";s:6:\"jQuery\";s:17:\"category_nicename\";s:6:\"jquery\";s:15:\"category_parent\";i:0;}"
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:14;s:4:\"name\";s:15:\"\u30D7\u30ED\u30B0\u30E9\u30E0\";s:4:\"slug\";s:7:\"program\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:14;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:121;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:14;s:14:\"category_count\";i:121;s:20:\"category_description\";s:0:\"\";s:8:\"cat_name\";s:15:\"\u30D7\u30ED\u30B0\u30E9\u30E0\";s:17:\"category_nicename\";s:7:\"program\";s:15:\"category_parent\";i:0;}"
  ...
tags: |
  ---
  - !php/object "O:7:\"WP_Term\":10:{s:7:\"term_id\";i:56;s:4:\"name\";s:6:\"jQuery\";s:4:\"slug\";s:6:\"jquery\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:57;s:8:\"taxonomy\";s:8:\"post_tag\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:25;s:6:\"filter\";s:3:\"raw\";}"
  ...
---
システムによっては月日が二桁を想定しているものもあるかと思います。
例えば2012年2月18日は「2012/2/18」ではなく「2012/<b>02</b>/18」とか。
<!--more-->
<span class="text-muted">(サーバサイドで直してやってもいいんですが、画面の方で修正した方がユーザーには分かりやすいかもしれないし…という事で)</span>

datepickerが閉じられた時に(onClose)、入力された日付を精査します。
精査の内容は以下の通りです。
<ul>
<li>西暦が4以上は今年の西暦をセットする（10000年とか）</li>
<li>月・日のゼロパディング</li>
<li>0月や0日が入力された場合は今月の月日をセットする</li>
</ul>
<pre class="prettyprint linenums">
&lt;script type=&quot;text/javascript&quot;&gt;
$(function() {
    // 本日の日付
    var nowdate = new Date();
    var year = nowdate.getFullYear();
    var mon  = nowdate.getMonth() + 1;
    var day  = nowdate.getDate();

    $(&quot;#datepicker&quot;).datepicker({
        onClose : function(selectedDate) {
            if(selectedDate!=&quot;&quot;){
                var dpckr = selectedDate.split(&quot;/&quot;);
                var fmYY  = dpckr[0]; // year
                var fmMM  = dpckr[1]; // month
                var fmDD  = dpckr[2]; // day
                
                // 空なら0入れておく
                if(fmYY==&quot;&quot; || fmYY==null){ fmYY = 0; }
                if(fmMM==&quot;&quot; || fmMM==null){ fmMM = 0; }
                if(fmDD==&quot;&quot; || fmDD==null){ fmDD = 0; }
                // 西暦が4桁以上の場合は今年をセット
                if (fmYY.length &gt; 4){ fmYY = year; }
                // ゼロパディング
                if (parseInt(fmMM, 10) &lt; 10) { fmMM = &quot;0&quot; + parseInt(fmMM, 10); }
                if (parseInt(fmDD, 10) &lt; 10) { fmDD = &quot;0&quot; + parseInt(fmDD, 10); }
                // 00の場合は今月、今日をセット
                if (fmMM == &quot;00&quot;) { fmMM = mon; }
                if (fmDD == &quot;00&quot;) { fmDD = day; }

                // セット
                $(this).val(fmYY + &quot;/&quot; + fmMM + &quot;/&quot; + fmDD);
                
            }
        }
    });
});
&lt;/script&gt;
</pre>

もう少し綺麗な書き方があると思うのですが、
年末でめんどくさくなってこれでいいやってなりました。
<span class="text-muted">(あまり複雑な状況は想定してないです。入力途中で日付や年が変わるだとか)</span>

他のdatapickerにも応用は訊くかと思います。