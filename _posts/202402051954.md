---
title: '[Next.js] GitHub Pagesに公開時の画像パスがズレる問題をbasePathを変えずに対処する方法'
date: 2024-02-05T10:54:31Z
updated:
tags:
  - Next.js
  - GitHub
  - GitHub Pages
---

## 環境

- Next.js
  - ビルド: Static Generation
  - バージョン: 14.1.0
- GitHub PagesにNext.jsでビルドした静的サイトをテスト公開している
  - URL: `https://username.github.io/repository-name/`
- 本番時は別の独自ドメインを使う
- `src/public`を`src/assets`にシンボリックリンクを貼っている

## 問題

以下のような形で画像を表示しようとした場合、GitHub Pagesはサブディレクトリがベースになってしまうため、`https://username.github.io/sugoi.png`にアクセスしようとしてしまう。

```html
<img src="/sugoi.png" alt="すごい画像" />
```

ページが`https://username.github.io/repository-name/`であれば、以下のような指定をすれば良い。

```html
<img src="sugoi.png" alt="すごい画像" />
```

ただ、`https://username.github.io/repository-name/2nd/`と階層を深くした場合は上記の方法では対応できない。

### basePathを変える

next.config.jsの`basePath`を変えることで対応ができるが、ローカルサーバでの起動時もベースパスが変わってしまう。

```js
module.exports = {
  basePath: process.env.GITHUB_PAGES === 'true ? '/repository-name' : '',
}
```

.envで環境変数を利用して開発時と本番時で切り替える方法もあるが、今回の場合はGitHub Pages公開時と本番時の独自ドメインでの公開するため、環境変数で切り替える方法だと煩雑になってしまう。

<small>※開発時と本番時は一致するはずだが、確定していない状況</small>

## 対処方法

以下のような形で`import`するとパスを取得できる。

<small>※画像はpublicディレクトリに配置しているが、assetsディレクトリをシンボリックリンク経由でアクセスができる状態</small>

```tsx
import SignatureImage from '@/assets/signature.png';

export default function Home() {
  return (
    <>
      <img src={SignatureImage.src} alt="" height="140" width="400" />
    </>
  );
}
```

以下のような画像情報を取得できる。

```js
{
  src: '/_next/static/media/signature.3e8d984e.png',
  height: 140,
  width: 400,
  blurDataURL: '/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fsignature.3e8d984e.png&w=8&q=70',
  blurWidth: 8,
  blurHeight: 3
}
```
