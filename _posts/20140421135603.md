---
title: "より良いjQueryのコードを記述するには"
date: 2014-04-21 13:56:03
updated: 2015-02-28 22:26:02
categories:
  - JavaScript
tags:
  - jQuery
---

より良い jQuery のコードを書くためにいくつかの方法を提言している[Writing Better jQuery Code](http://flippinawesome.org/2013/11/25/writing-better-jquery-code/)を紹介します。

リンク切れの部分は省略しております。また、本文についても意訳や誤訳で若干意味が異なっている部分等あるかもしれません。予めご了承ください。

詳細は翻訳元をご確認ください。

<!--more-->

## 変数のキャッシング

DOM のトラバーサルは負荷が掛かりますので、それらを再利用する際は選択した要素をキャッシュするようにしてみてください。

```js
// bad
h = $("#element").height();
$("#element").css("height", h - 20);

// good
$element = $("#element");
h = $element.height();
$element.css("height", h - 20);
```

## グローバルを避ける

jQuery を使って、一般的には JavaScript と同様に、変数が適切に関数内でスコープが設定されていることを確認することをお勧めします。

```js
// bad
$element = $("#element");
h = $element.height();
$element.css("height", h - 20);

// good
var $element = $("#element");
var h = $element.height();
$element.css("height", h - 20);
```

## ハンガリアン記法を使う

変数の前に$記号を置くことで、このアイテムは jQuery オブジェクトが含まれていることを認識しやすくなります。

```js
// bad
var first = $("#first");
var second = $("#second");
var value = $first.val();

// better - we use to put \$ symbol before jQuery-manipulated objects
var $first = $("#first");
var $second = $("#second");
var value = $first.val();
```

## 変数チェインを使う(単独変数パターン)

複数の変数文を持つのではではなく、単一のステートメントにそれらを組み合わせることができます。最後に割り当てられた値なしの変数を置くことをお勧めします。

```js
var $first = $("#first"),
  $second = $("#second"),
  value = $first.val(),
  k = 3,
  cookiestring = "SOMECOOKIESPLEASE",
  i,
  j,
  myArray = {};
```

## ‘On’が好ましい

jQuery の最近のバージョンでは、 `click()` のような関数が `on('click')` の省略形であるように変更されています。 以前のバージョンでは `click()` は `bind()` の為の省略形という実装とは異なっていた。jQuery の 1.7 の時点では、 `on()` がイベントハンドラを取り付けるための好ましい方法である。しかしながら、一貫性を保つために、単に一律に `on()` を使用できます。

```js
// bad
$first.click(function () {
  $first.css("border", "1px solid red");
  $first.css("color", "blue");
});

$first.hover(function () {
  $first.css("border", "1px solid red");
});

// better
$first.on("click", function () {
  $first.css("border", "1px solid red");
  $first.css("color", "blue");
});

$first.on("hover", function () {
  $first.css("border", "1px solid red");
});
```

## JavaScript を凝縮する

一般に、可能な限りの機能を組み合わせることを試みることが好ましい。

```js
// bad
$first.click(function(){
  $first.css('border','1px solid red');
\$first.css('color','blue');
});

// better
$first.on('click',function(){
  $first.css({
'border':'1px solid red',
'color':'blue'
});
});
```

## チェインを使う

上記のルールに続き、jQuery はチェインメソッドを簡単に利用できます。

```js
// bad
$second.html(value);
$second.on("click", function () {
  alert("hello everybody");
});
$second.fadeIn("slow");
$second.animate({ height: "120px" }, 500);

// better
$second.html(value);
$second
  .on("click", function () {
    alert("hello everybody");
  })
  .fadeIn("slow")
  .animate({ height: "120px" }, 500);
```

## コードの可読性を保つ

スクリプトを凝縮し、連鎖を利用しようとすると、コードが時々読めなくなります。可読性を保つためにタブや改行をしてみてください。

```js
// bad
$second.html(value);
$second
  .on("click", function () {
    alert("hello everybody");
  })
  .fadeIn("slow")
  .animate({ height: "120px" }, 500);

// better
$second.html(value);
$second
  .on("click", function () {
    alert("hello everybody");
  })
  .fadeIn("slow")
  .animate({ height: "120px" }, 500);
```

## 短絡評価が好ましい

[短絡評価](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_Operators#Short-Circuit_Evaluation)は左から右から評価式で && (AND)または || (OR) の演算子を使用します。

```js
// bad
function initVar($myVar) {
  if (!$myVar) {
    $myVar = $("#selector");
  }
}

// better
function initVar($myVar) {
  $myVar = $myVar || $("#selector");
}
```

## ショートカットが好ましい

符号化のショートカットを利用することはコードを凝縮させる方法の1つです。

```js
// bad
if(collection.length > 0){..}

// better
if(collection.length){..}
```

## 重い操作を行うとするときに、要素を切り離す

もし、あなたは DOM 要素の重い操作を行おうとしている場合は、最初にそれを切り離してから、それを再追加することをお勧めします。

```js
// bad
var
$container = $("#container"),
$containerLi = $("#container li"),
\$element = null;

$element = $containerLi.first();
//... a lot of complicated things

// better
var
$container = $("#container"),
$containerLi = $container.find("li"),
\$element = null;

$element = $containerLi.first().detach();
//...a lot of complicated things

$container.append($element);
```

## トリックを知ること

経験が少ないあなたが jQuery メソッドを使用する場合、それを使用することが好ましいか、より高速な方法があるかどうか、[ドキュメント](http://api.jquery.com/)を確認するようにしてください。

```js
// bad
$("#id").data(key, value);

// better (faster)
$.data("#id", key, value);
```

## サブクエリキャッシュの親を使用

先に述べたように、DOM のトラバーサルは負荷のかかる操作です。通常は、親要素をキャッシュし子要素を選択する際に、これらのキャッシュされた要素を再利用することをお勧めします。

```js
// bad
var $container = $("#container"),
  $containerLi = $("#container li"),
  $containerLiSpan = $("#container li span");

// better (faster)
var $container = $("#container "),
  $containerLi = $container.find("li"),
  $containerLiSpan = $containerLi.find("span");
```

## ユニバーサルセレクタを避ける

他のセレクタと組み合わせたときに、ユニバーサルセレクタ（ワイルドカード）は非常に遅いです。

```js
// bad
$(".container > *");

// better
$(".container").children();
```

## 暗黙ユニバーサルセレクタを避ける

セレクタをやめたとき、ユニバーサルセレクタ（\*）はまだ含まれています。

```js
// bad
$(".someclass :radio");

// better
$(".someclass input:radio");
```

## セレクタを最適化

例えば、ID を使用すると既に十分に具体的であるので、さらなるセレクタを具体的に追加する必要がありません。

```js
// bad
$("div#myid");
$("div#footer a.myLink");

// better
$("#myid");
$("#footer .myLink");
```

## 複数の ID を探索しない

繰り返しますが、適切に使用したとき ID は複数の子孫セレクタの追加を必要としません。

```js
// bad
$("#outer #inner");

// better
$("#inner");
```

## 最新バージョンを使用すること

最新バージョンは、通常は最高のものです：時には軽く、時には速く。明らかに、あなたがサポートしているコードとの互換性を考慮する必要があります。たとえば、バージョン 2.0 からは IE6/7/8 のための多くのサポートがないという事を留意してください。

## 推奨されないメソッドを使用しないこと

常にそれぞれの新しいバージョン用の[非推奨のメソッド](http://api.jquery.com/category/deprecated/)から目を離さず、それらを使用しないようにすることが重要です。

```js
// bad - live is deprecated
$("#stuff").live("click", function () {
  console.log("hooray");
});

// better
$("#stuff").on("click", function () {
  console.log("hooray");
});
```

CDN から jQuery のコードをロードする
Google の CDN は、すぐに、ユーザーの最寄りのキャッシュの場所からスクリプトを提供します。 Google の CDN を使用するには次の URL を使用します。
https://code.jQuery.com/jQuery-latest.min.js

## 必要に応じてネイティブ JavaScript と jQuery を組み合わせる

前に述べていたように、jQuery は JavaScript のであり、これは、ネイティブ JavaScript は jQuery で行うのと同じことを行うことができることを意味します。 ネイティブ JavaScript(もしくは[vanilla](http://vanilla-js.com/))で書くことで、しばしば読みにくくし、保守しやすくないコードと長いファイルになってしまいます。 しかし、それは高速なコードを意味しています。どんなフレームワークも、ネイティブの JavaScript の動作よりも小さく軽く、速くなることはないこと覚えておいてください。

この JavaScript と jQuery の性能差に起因して、私は[jQuery の機能に相当するネイティブ](http://www.leebrimelow.com/native-methods-jQuery/)を使用して、それらの両方を混合は賢明な方法でとてもお勧めします。

## 最終的な考慮事項

最後に、私は他の優良事例が多数含まれている[jQuery のパフォーマンス](http://net.tutsplus.com/tutorials/JavaScript-ajax/10-ways-to-instantly-increase-your-jQuery-performance/)に関する記事をお勧めします。その話題についてより深く見たい場合は面白いでしょう。

jQuery が必要条件と選択ではないことに注意してください。 あなたがそれを使用している理由を考えてみましょう。 DOM 操作？ Ajax？ テンプレート？ CSS アニメーション？ セレクタエンジン？ 場合によっては、[マイクロ JavaScript フレームワーク](http://microjs.com/)や、具体的ニーズに合わせて調整した[jQuery のカスタムビルド](http://net.tutsplus.com/tutorials/JavaScript-ajax/how-to-build-your-own-custom-jQuery/)を検討する価値があるかもしれないです。

この記事は http://blog.mathewdesign.com/2013/11/14/writing-performant-and-quality-jquery-code/ に掲載されていました。

---

Thanks to Mathew Carella.
