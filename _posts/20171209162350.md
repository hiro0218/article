---
ID: 3437
post_title: '[jQuery] 非同期通信後に別のスクリプトを実行する方法'
published: true
post_date: 2017-12-09 16:23:50
modified_date: 2017-12-09 16:23:50
slug: 20171209162350.html
categories: |
  ---
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:383;s:4:\"name\";s:6:\"jQuery\";s:4:\"slug\";s:6:\"jquery\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:401;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:16;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:383;s:14:\"category_count\";i:16;s:20:\"category_description\";s:0:\"\";s:8:\"cat_name\";s:6:\"jQuery\";s:17:\"category_nicename\";s:6:\"jquery\";s:15:\"category_parent\";i:0;}"
  ...
tags: |
  ---
  - jQuery
  ...
---
## 背景

既存のレガシープロダクトにて、「エンドポイントの異なる複数のXHR通信をした結果を元にスクリプトを実行したい」という要件があった。

具体的に云うと以下のような流れ。

1. 記事データをn件取得
2. 取得した記事データ群からカルーセルを作成

<!--more-->

## 方法

```language-javascript
var results = [];

// 1. 複数のXHR通信を行う処理
function summarize() {
  var ids = [1, 2, 3, 4, 5];
  var promises = [];

  $.each(ids, function(i, value) {
    var deferred = $.Deferred();
    promises.push(
      $.ajax({
        method: &quot;GET&quot;,
        url: &quot;https://jsonplaceholder.typicode.com/posts/&quot; + value,
        success: function(data) {
          results.push(data);
        },
        complete: function() {
          deferred.resolve();
        }
      })
    );
  });
  
  return promises;
}

$.when.apply($, summarize())
  .then(function() {
    // 2. XHR通信後に実行したい処理
    console.log(results);
  });
```

既にjQueryで組まれたサイトであった為、そのままjQueryの`$.Deferred()`,`$.when`を使用した。

## 参考

* [jQuery Deferredまとめ](https://qiita.com/hththt/items/9f193fc10b79cdeea903)
* [結果の順番を保証して、且つ『並列』でAjax通信を行う方法](https://qiita.com/YusukeHirao/items/bca14c5f2fe4026fd4d7)