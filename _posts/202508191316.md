---
title: '[nodenv] Claude Codeを違うNode.jsバージョンでも共通で使う方法'
date: 2025-08-19T04:16:13Z
updated: 2025-11-03T09:45:00Z
tags:
  - Node.js
  - Claude Code
  - bash
---

> [!NOTE]
> **ネイティブ版の利用を推奨**  
> Claude CodeはNode.jsに依存しないネイティブ版が利用可能になった。ネイティブ版を使用すれば、本記事で説明するバージョン切り替えの問題は発生しない。  
> https://docs.claude.com/ja/docs/claude-code/setup

## 問題

- [nodenv](https://github.com/nodenv/nodenv)でNode.jsバージョンごとに独立したパッケージ環境
- Claude Codeは`22.12.0`にのみインストール済み
- 他のバージョンに切り替えると`claude`コマンドが使えない
  - 各環境で個別にインストールが必要になる

### volta

voltaの場合、パッケージ管理機能により`volta install`で環境間の移動時も同じバージョンのパッケージを利用できる。

```bash
volta install @anthropic-ai/claude-code
```

https://www.voltajs.com/reference/install.html

## 解決策

シェルエイリアスでこの問題を解決できる。

### 1. エイリアスを設定

使用しているシェルの設定ファイルを編集：

```bash
# zshの場合
vim ~/.zshrc

# bashの場合
vim ~/.bashrc
```

以下のいずれかを追加：

```bash
alias claude='NODENV_VERSION=22.12.0 claude'
```

```bash
claude() {
  NODENV_VERSION=22.12.0 command claude "$@"
}
```

### 2. 設定を反映

```bash
# zshの場合
source ~/.zshrc

# bashの場合
source ~/.bashrc
```

### 3. 動作確認

任意のNode.jsバージョンで確認してみる。

```bash
# 別のバージョンに切り替え
nodenv local 18.17.0

# Claude Codeが使えることを確認
claude -v
```

## 動作の仕組み

- Claude Codeは Node.js 22.12.0 環境にインストールされている
- `NODENV_VERSION=22.12.0` により、コマンド実行時のみ一時的に Node.js 22.12.0 を使用
- エイリアス経由で常に 22.12.0 環境の `claude` コマンドが実行される
- 現在のNode.jsバージョンに関係なく、同じコマンドで利用可能

## この方法の利点

- 1行追加するだけで設定完了
- インストール済みバージョンの固定指定により動作が安定
- 通常の`claude`コマンドと同じ操作感

この設定により、プロジェクトごとに異なるNode.jsバージョンを使用していても、Claude Codeを問題なく利用できる。
