---
ID: 1121
post_title: '[PHP] cURLのPOSTでファイルアップロードする方法'
author: hiro
layout: post
permalink: https://b.0218.jp/20140117004504.html
published: true
post_date: 2014-01-17 00:45:04
modified_date: ""
slug: 20140117004504.html
---
cURLでのファイルアップロード方法が分からず試行錯誤してました。

色々と調べて`$f = fopen($_FILES[$file_data]['tmp_name'], 'r');`を`curl_setopt($conn, CURLOPT_INFILE, $f);`で指定してみたりもしましたが上手くいきませんでした…。
<span class="text-muted">もしかしたら別の環境では上手くいくのかしら…?</span>

最終的に上手く動いてくれた方法の覚書です。

<!--more-->

## 方法

```language-php
&lt;?php
// API
$url = &#039;http://api-server/&#039;;

$tmpfile  = $_FILES[$file_data][&#039;tmp_name&#039;];
$filename = $_FILES[$file_data][&#039;name&#039;];

$data = array(
    &#039;filedata_param&#039; =&gt; &#039;@&#039; . $tmpfile . &#039;;filename=&#039; . $filename
);

$conn = curl_init();

curl_setopt($conn, CURLOPT_SSL_VERIFYPEER, false);
curl_setopt($conn, CURLOPT_SSL_VERIFYHOST, false);
curl_setopt($conn, CURLOPT_RETURNTRANSFER, true);
curl_setopt($conn, CURLOPT_URL, $url);
curl_setopt($conn, CURLOPT_POST, true);
curl_setopt($conn, CURLOPT_POSTFIELDS, $data);

$res = curl_exec($conn);

curl_close($conn); 
```

そもそもcURLでアップロードするファイルを指定する時は`file=@file.zip;type=application/x-zip-compressed`な感じで指定してやる必要があるわけで。
それと同じようにPHPでも指定してやると上記のようになります。