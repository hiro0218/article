---
ID: 2276
post_title: >
  WordPress 4.4 で追加された Embed
  を無効化する方法
published: true
post_date: 2015-12-15 13:55:35
modified_date: 2015-12-15 13:55:35
slug: 20151215135535.html
categories: |
  ---
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:76;s:4:\"name\";s:9:\"WordPress\";s:4:\"slug\";s:9:\"wordpress\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:78;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:37;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:76;s:14:\"category_count\";i:37;s:20:\"category_description\";s:0:\"\";s:8:\"cat_name\";s:9:\"WordPress\";s:17:\"category_nicename\";s:9:\"wordpress\";s:15:\"category_parent\";i:0;}"
  ...
tags: |
  ---
  - !php/object "O:7:\"WP_Term\":10:{s:7:\"term_id\";i:421;s:4:\"name\";s:9:\"WordPress\";s:4:\"slug\";s:9:\"wordpress\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:79;s:8:\"taxonomy\";s:8:\"post_tag\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:36;s:6:\"filter\";s:3:\"raw\";}"
  ...
---
WordPress4.2 から「Embed」が追加された。
<!--more-->
<h2>Embedとは</h2>
こんなやつ。
<blockquote><img src="https://wpdocs.osdn.jp/wiki/images/wp_embed_preview.png">
投稿を他のサイトを埋め込めるようになりました。他の WordPress サイトにも埋め込み可能です。エディターに投稿の URL を入れるだけで、設定したタイトル、抜粋、アイキャッチ画像を備えた埋め込みプレビューがすぐに表示されます。さらに、サイトアイコンやコメント、共有用 リンクも含まれます。</blockquote>

<h2>無効化する方法</h2>
<h3>状況</h3>
4.4にアップグレードしてみると、知らない子が<code>&lt;head&gt;</code>内に追加されてますね…。
<pre class="language-markup"><code>&lt;link rel="alternate" type="application/json+oembed" href="http://localhost/wordpress/wp-json/oembed/1.0/embed?url=http%3A%2F%2Flocalhost%2Fwordpress%2F20100806080939.html" /&gt;
&lt;link rel="alternate" type="text/xml+oembed" href="http://localhost/wordpress/wp-json/oembed/1.0/embed?url=http%3A%2F%2Flocalhost%2Fwordpress%2F20100806080939.html&amp;#038;format=xml" /&gt;</code></pre>

<h3>functions.phpに追加するコード</h3>
以下を追加する。
<pre class="language-php"><code>add_filter('embed_oembed_discover', '__return_false');
remove_action('wp_head','rest_output_link_wp_head');
remove_action('wp_head','wp_oembed_add_discovery_links');
remove_action('wp_head','wp_oembed_add_host_js');</code></pre>

<h2>参考</h2>
<ul>
<li><a href="https://wordpress.org/support/topic/wp-44-remove-json-api-and-x-pingback-from-http-headers">https://wordpress.org/support/topic/wp-44-remove-json-api-and-x-pingback-from-http-headers</a></li>
</ul>