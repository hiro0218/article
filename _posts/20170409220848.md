---
ID: 3014
post_title: '[JavaScript] 空のGETパラメータを送信しない方法'
published: true
post_date: 2017-04-09 22:08:48
modified_date: 2017-04-09 22:08:48
slug: 20170409220848.html
categories: |
  - JavaScript
tags: |
  - jQuery
is_markdown: true
---
[以前投稿した方法](https://b.0218.jp/20141007135727.html)は、jQueryに依存していたので、Vanillaで実装し直してみた。

## 方法
### 前提
こんな感じのフォームがある。
```language-markup
<form name=&#039;form1&#039;>
  <input name=&#039;hoge1&#039; type=&#039;text&#039;>
  <input name=&#039;hoge2&#039; type=&#039;text&#039;>
  <input name=&#039;hoge3&#039; type=&#039;text&#039;>
  <input name=&#039;hoge4&#039; type=&#039;text&#039;>
  <input type=&#039;submit&#039;>
</form>
```

このフォームの`hoge1`だけ入力してサブミットするとパラメータが以下のようになる。
```
?hoge1=a&hoge2=&hoge3=&hoge4=
```

未入力のパラメータは以下のように消したい。
```
?hoge1=a
```

### コード
```language-javascript
document.forms.form1.addEventListener(&#039;submit&#039;, clean_query);

function clean_query(e) {
  e.preventDefault();
  this.removeEventListener(&#039;submit&#039;, clean_query);
  var query = serialize(this);
  location.href = this.action + &#039;?&#039; + (function(){
    var arr = [];
    [].forEach.call(query.split(&#039;&&#039;), function(item) {
      if (item.split(&#039;=&#039;)[1]) {
        arr.push(item);
      }
    });
    return arr.join(&#039;&&#039;);
  })();
}

function serialize(form) {
  var s = [];
  if (typeof form !== &#039;object&#039; && form.nodeName.toUpperCase() !== &#039;FORM&#039;) {
    return s;
  }

  var length = form.elements.length;
  for (var i = 0; i < length; i++) {
    var field = form.elements[i];
    if (field.name && !field.disabled && field.type != &#039;file&#039; && field.type != &#039;reset&#039; && field.type != &#039;submit&#039; && field.type != &#039;button&#039;) {
      if (field.type == &#039;select-multiple&#039;) {
        var l = form.elements[i].options.length;
        for (var j = 0; j < l; j++) {
          if (field.options[j].selected) {
            s[s.length] = encodeURIComponent(field.name) + &#039;=&#039; + encodeURIComponent(field.options[j].value);
          }
        }
      } else if ((field.type != &#039;checkbox&#039; && field.type != &#039;radio&#039;) || field.checked) {
        s[s.length] = encodeURIComponent(field.name) + &#039;=&#039; + encodeURIComponent(field.value);
      }
    }
  }
  return s.join(&#039;&&#039;).replace(/%20/g, &#039;+&#039;);
}
```