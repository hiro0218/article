---
ID: 2306
post_title: '[JavaScript] jQueryを使わずにAjax通信をしてJSONを取得する方法'
published: true
post_date: 2015-12-23 09:00:38
modified_date: 2015-12-22 13:37:18
slug: 20151223090038.html
---
<p class="c-alert is-info">この記事は <a href="http://qiita.com/advent-calendar/2015/javascript">JavaScript Advent Calendar 2015</a> の23日目です。</p>
<p><!--more--></p>
<h2>概要</h2>
<ul>
<li>JSONを吐き出すAPIのデータを取得する。</li>
<li>ただし、jQueryは使用できないものとする。</li>
</ul>
<h3>想定</h3>
<p>レガシーブラウザは念頭にない。（レガシー考慮するなら jQuery 使おう！）</p>
<h3>jQueryを使用した場合</h3>
<p>ちなみにjQueryを使用できるのであれば以下のようなコードで良い。</p>
<pre class="language-javascript"><code>$.getJSON("http://localhost/api/hoge", data, function(json){
    console.log(json);
});</code></pre>
<p>簡潔に記述することができる。</p>
<h2>Vanillaで実装する</h2>
<p>jQuery と仕様を合わせるつもりはないが、以下の様な実装で実現可能。</p>
<pre><code class="language-javascript">function getJSONData(url, callback) {
  var xhr = new XMLHttpRequest();

  xhr.onerror = function() {
    console.log('error');
  }

  xhr.onreadystatechange = function() {
    if (this.readyState === 4 &amp;&amp; this.status === 200) {
      var response = this.response;
      if (typeof response === 'string') {
        response = JSON.parse(response);
      }

      callback(response, header);
    }
  };

  xhr.open('GET', url, true);
  xhr.responseType = 'json';
  xhr.send();
}
</code></pre>
<hr>
<p><b>課題</b>:</p>
<ul>
<li>JSON.parseのラッパーを用意したほうが良いかも</li>
<li>ステータスコードを返そう</li>
</ul>
<h3>使い方</h3>
<pre class="language-javascript"><code>getJSONData("http://localhost/api/hoge", function(json) {
    console.log(json);
});</code></pre>
<h2>おまけ</h2>
<p>こういうのもある。</p>
<p><a href="https://github.com/hiro0218/jquery.ajax">jquery.ajax</a></p>