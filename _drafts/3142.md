---
ID: 3142
post_title: '[WordPress] 投稿時間の相対差(time ago)を出力する方法'
published: false
post_date: 2017-08-27 20:33:15
modified_date: 2017-08-27 20:33:15
slug: '[WordPress] 投稿時間の相対差(time ago)を出力する方法'
categories: |
  ---
  - !php/object "O:7:\"WP_Term\":16:{s:7:\"term_id\";i:76;s:4:\"name\";s:9:\"WordPress\";s:4:\"slug\";s:9:\"wordpress\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:78;s:8:\"taxonomy\";s:8:\"category\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:37;s:6:\"filter\";s:3:\"raw\";s:6:\"cat_ID\";i:76;s:14:\"category_count\";i:37;s:20:\"category_description\";s:0:\"\";s:8:\"cat_name\";s:9:\"WordPress\";s:17:\"category_nicename\";s:9:\"wordpress\";s:15:\"category_parent\";i:0;}"
  ...
tags: |
  ---
  - !php/object "O:7:\"WP_Term\":10:{s:7:\"term_id\";i:421;s:4:\"name\";s:9:\"WordPress\";s:4:\"slug\";s:9:\"wordpress\";s:10:\"term_group\";i:0;s:16:\"term_taxonomy_id\";i:79;s:8:\"taxonomy\";s:8:\"post_tag\";s:11:\"description\";s:0:\"\";s:6:\"parent\";i:0;s:5:\"count\";i:36;s:6:\"filter\";s:3:\"raw\";}"
  ...
---
## 概要

`1 minutes ago`、`2 days ago`など相対的な時間差を出力する。

## コード

WordPressに標準関数があるが、痒いところに手が届かないため、もし細かい調整などが必要であれば自前で実装するほうが良い。

### WordPressの標準関数

`human_time_diff`を使用する。
`human_time_diff`への引数には、($from, $to)の形式で渡す。

```language-php
echo human_time_diff( get_the_time(&#039;U&#039;), current_time(&#039;timestamp&#039;) ) . &#039; ago&#039;;
```


### 自前で実装する

```language-php
function get_posted_time_ago($timestamp) {
    if ($timestamp === null) {
        return &#039;&#039;;
    }

    $current_time = time();
    $difference = ($current_time - $timestamp);
    $periods = [&#039;second&#039;, &#039;minute&#039;, &#039;hour&#039;, &#039;day&#039;, &#039;week&#039;, &#039;month&#039;, &#039;year&#039;, &#039;decade&#039;];
    $lengths = [60, 60, 24, 7, 4.35, 12, 10];

    for ($i = 0; isset($lengths[$i]) and $difference &gt;= $lengths[$i]; $i++) {
        $difference /= $lengths[$i];
    }

    $difference = round($difference);

    if ($difference != 1) {
        $periods[$i] = $periods[$i] . &#039;s&#039;;
    }

    if ($difference &lt;= 0) {
        return &quot;&quot;;
    }

    return $difference . &#039; &#039; . $periods[$i] . &#039; ago&#039;;
}
```

### 更新されているか否かをチェックする

```language-php
function is_modified_post() {
    return (get_the_time(&#039;Ymd&#039;) &lt; get_the_modified_time(&#039;Ymd&#039;));
}
```